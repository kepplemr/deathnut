version: '2'
services:
  redis:
    image: redis:3.2.5-alpine
    container_name: redis
    ports:
      - "6379:6379"
  # recipe-service-apispec:
  #   build: .
  #   image: recipe-service
  #   container_name: recipe-service-apispec
  #   ports:
  #     - "80:80"
  #   volumes:
  #     - ./keys:/keys
  #     - ../../deathnut:/deathnut
  #     - ./deploy:/recipe-service/deploy
  #   links:
  #     - "redis"
  recipe-service-restplus:
    build: .
    image: recipe-service
    container_name: recipe-service-restplus
    ports:
      - "81:80"
    volumes:
      - ./keys:/keys
      - ../../deathnut:/deathnut
      - ./deploy:/recipe-service/deploy
    links:
      - "redis"
    command:
      ["python" , "/recipe-service/flask/app-restplus.py", "--generate-openapi-template"]
  # esp-apispec:
  #   image: gcr.io/endpoints-release/endpoints-runtime:1
  #   container_name: esp-apispec
  #   ports:
  #     - "8080:8080"
  #   volumes:
  #     - ./keys:/keys
  #   command: ["--service=recipe-service.endpoints.wellio-dev-michael.cloud.goog", "--rollout_strategy=managed", 
  #   "--backend=recipe-service-apispec:80", "--http_port=8080", "--service_account_key=/keys/jwt-test.json"]
  esp-restplus:
    image: gcr.io/endpoints-release/endpoints-runtime:1
    container_name: esp-restplus
    ports:
      - "8081:8081"
    volumes:
      - ./keys:/keys
    command: ["--service=recipe-service.endpoints.wellio-dev-michael.cloud.goog", "--rollout_strategy=managed", 
    "--backend=recipe-service-restplus:80", "--http_port=8081", "--service_account_key=/keys/jwt-test.json"]