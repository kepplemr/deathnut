version: 2.1
orbs:
  gcp-cli: circleci/gcp-cli@1.8.3
  linter: thekevjames/linter@1.0.36
commands:
  install: gcp-cli/install
  initialize: gcp-cli/initialize
  pre-commit: linter/pre-commit
jobs:
  # precommit -> test -> deploy
  pre-commit-check:
    docker: 
      - image: python:3.7.6
    steps:
      - checkout
      - pre-commit
  deploy:
    executor: gcp-cli/google
    steps:
      - install:
          version: 268.0.0
      - initialize
      - run: gcloud
workflows:
  build_test_deploy:
    jobs:
      - pre-commit-check
      - deploy:
          requires:
            - pre-commit-check
